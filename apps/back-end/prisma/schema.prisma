generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  Int       @id @default(autoincrement())
  email               String    @unique
  password            String
  name                String?
  role                String    @default("VIEWER")
  bio                 String?
  avatarId            Int?
  avatar              Upload?   @relation(fields: [avatarId], references: [id])
  resetToken          String?
  resetTokenExpires   DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  forcePasswordChange Boolean   @default(false)

  @@map("users")
}

model Project {
  id              Int       @id @default(autoincrement())
  title           String
  description     String?
  fullDescription String
  category        String?
  imageId         Int?
  image           Upload?   @relation(fields: [imageId], references: [id])
  date            String?
  status          String    @default("PUBLISHED")
  publishedAt     DateTime?
  seoTitle        String?
  seoDescription  String?
  views           Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("projects")
}

model TeamMember {
  id        Int      @id @default(autoincrement())
  name      String
  role      String
  email     String?
  imageId   Int?
  image     Upload?  @relation(fields: [imageId], references: [id])
  status    String   @default("Ativo")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("team_members")
}

model HistoryEvent {
  id        Int      @id @default(autoincrement())
  year      String
  event     String
  type      String
  imageId   Int?
  image     Upload?  @relation(fields: [imageId], references: [id])
  date      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("history_events")
}

model Document {
  id        Int      @id @default(autoincrement())
  name      String
  category  String   @default("Outros")
  uploadId  Int?     @unique
  upload    Upload?  @relation(fields: [uploadId], references: [id])
  isPublic  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("documents")
}

model Upload {
  id           Int      @id @default(autoincrement())
  filename     String   @unique
  originalName String
  mimetype     String
  size         Int
  url          String
  createdAt    DateTime @default(now())

  // Relations
  projects      Project[]
  teamMembers   TeamMember[]
  historyEvents HistoryEvent[]
  document      Document?
  users         User[]

  @@map("uploads")
}

model AuditLog {
  id         Int      @id @default(autoincrement())
  userId     Int
  action     String
  entityType String
  entityId   Int
  payload    String?
  createdAt  DateTime @default(now())

  @@map("audit_logs")
}

model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt

  @@map("settings")
}
